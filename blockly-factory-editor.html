<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="./ace-editor.html">

<dom-module id="blockly-factory-editor">
	<template>
		<style>
			:host {
				position: relative;
				overflow: scroll;
				background-color: #272822;
			}

			#defCodeEditor {
				/* not sure why part of the top is shifted outside */
				margin-top: 4px;
			}
		</style>

		<ace-editor id="defCodeEditor" readonly no-highlight on-change="onDefCodeEditorChange_"></ace-editor>
		<ace-editor id="implCodeEditor" on-change="onImplCodeEditorChange_"></ace-editor>
	</template>

	<script>
		'use strict';

		Polymer({
			is: 'blockly-factory-editor',

			properties: {
				defCode: {
					type: String,
					notify: true,
					observer: 'onDefCodeChange_'
				}
			},

			listeners: {
				'tap': 'onTap_'
			},

			updateLineNumber_() {
				// update impl code editor first line number
				this.$.implCodeEditor.firstLineNumber = this.$.defCodeEditor.lineCount + 1;

				// update style
				let defLength = this.$.defCodeEditor.lineCount,
					implLength = this.$.implCodeEditor.lineCount + defLength,
					indent = implLength.toString().length;
				this.$.defCodeEditor.gutterIndent = indent;
			},

			onDefCodeChange_(code) {
				this.$.defCodeEditor.value = code;
			},

			onDefCodeEditorChange_() {
				this.updateLineNumber_();
			},

			onImplCodeEditorChange_() {
				this.updateLineNumber_();
			},

			onTap_(e) {
				if(e.target === this) {
					this.$.implCodeEditor.focus();
				}
			}
		});
	</script>
</dom-module>