<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../acelymer/ace-editor-stack.html">

<dom-module id="blockly-factory-editor">
	<template>
		<style>
			:host {
				position: relative;
			}

			#stack {
				overflow: scroll;
				background-color: #272822;
			}
		</style>

		<ace-editor-stack id="stack" class="fl-full">
			<!-- definition code output by the blockly factory workspace -->
			<ace-editor id="defCodeEditor" readonly disable-syntax-check wrap></ace-editor>

			<!-- implementation code written by the user -->
			<ace-editor id="prefix" readonly disable-syntax-check wrap></ace-editor>
			<ace-editor id="implCodeEditor" wrap></ace-editor>
			<ace-editor readonly disable-syntax-check wrap>}</ace-editor>
		</ace-editor-stack>
	</template>

	<script>
		'use strict';

		Polymer({
			is: 'blockly-factory-editor',

			properties: {
				defCode: {
					type: Object,
					notify: true,
					observer: 'onDefCodeChange_'
				},
				blockType: String
			},

			listeners: {
				'stack.tap': 'onTap_'
			},

			onDefCodeChange_(defCode) {
				this.$.prefix.code = `// Here is the actual implementation\nfunction ${defCode.blockType}() {`;
				this.$.defCodeEditor.code = defCode.code;
			},

			onTap_(e) {
				if(e.target === this.$.stack) {
					this.$.implCodeEditor.focus();
				}
			}
		});
	</script>
</dom-module>